<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orbit Guard - Asteroid Impact Simulator</title>

  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />

  <!-- Turf.js (Geospatial math) -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <!-- Three.js (3D orbital visualization) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="/static/style.css" />

  <script>
    const MAPBOX_TOKEN = "{{ MAPBOX_TOKEN }}";
  </script>
</head>
<body>
  <div class="container">
    <!-- Left Control Panel -->
    <aside id="left-panel">
      <div class="panel-content">
        <div class="brand">
          <div class="brand-icon">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="20" cy="20" r="18" stroke="url(#grad1)" stroke-width="2"/>
              <circle cx="20" cy="20" r="8" fill="url(#grad1)"/>
              <path d="M20 4 L24 12 L20 20 L16 12 Z" fill="url(#grad1)" opacity="0.6"/>
              <defs>
                <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#0099ff;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h1>ORBIT GUARD</h1>
          <h2>Asteroid Impact Simulator</h2>
        </div>

        <div class="instruction-card">
          <svg class="info-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 16v-4M12 8h.01"/>
          </svg>
          <p>Click anywhere on the globe to select an impact location.</p>
        </div>

        <div class="controls">
          <!-- Diameter -->
          <div class="control-group">
            <label for="diameter">
              <span class="label-text">Asteroid Diameter</span>
              <span id="diameterValue" class="value-display">1 km</span>
            </label>
            <input type="range" id="diameter" min="0.001" max="1000" step="0.001" value="1" class="slider" />
          </div>

          <!-- Velocity -->
          <div class="control-group">
            <label for="velocity">
              <span class="label-text">Impact Velocity</span>
              <span id="velocityValue" class="value-display">20 km/s</span>
            </label>
            <input type="range" id="velocity" min="11" max="72" step="0.1" value="20" class="slider" />
          </div>

          <!-- Angle -->
          <div class="control-group">
            <label for="angle">
              <span class="label-text">Impact Angle</span>
              <span id="angleValue" class="value-display">45°</span>
            </label>
            <input type="range" id="angle" min="0" max="90" step="1" value="45" class="slider" />
          </div>

          <!-- Composition -->
          <div class="control-group">
            <label for="composition">
              <span class="label-text">Asteroid Composition</span>
              <span id="compositionValue" class="value-display">Dense Rock</span>
            </label>
            <select id="composition" class="composition-select">
              <option value="1000">Ice (1,000 kg/m³)</option>
              <option value="1500">Porous Rock (1,500 kg/m³)</option>
              <option value="3000" selected>Dense Rock (3,000 kg/m³)</option>
              <option value="8000">Iron (8,000 kg/m³)</option>
            </select>
          </div>

          <!-- Population Density -->
          <div class="control-group">
            <label for="popDensity">
              <span class="label-text">Population Density</span>
              <span id="popDensityValue" class="value-display">100 /km²</span>
            </label>
            <input type="range" id="popDensity" min="0" max="100000" step="50" value="100" class="slider" />
          </div>
        </div>

        <button id="runBtn" class="btn-primary">
          <span class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
            </svg>
          </span>
          RUN SIMULATION
        </button>
      </div>
    </aside>

    <!-- Map -->
    <main id="map"></main>

    <!-- Results -->
    <div id="resultsOverlay" class="results" style="display:none;">
      <div class="results-header">
        <h3>IMPACT ANALYSIS</h3>
        <div class="pulse-indicator"></div>
      </div>
      <div class="results-content"></div>
    </div>

    <!-- NASA NEO Button -->
    <button id="neoButton" title="View real NASA Near-Earth Objects">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
        <path d="M2 12h20"/>
      </svg>
      NASA NEOs
    </button>

    <!-- DEFEND EARTH Button -->
    <button id="defendEarthBtn" class="game-btn" title="Defend Earth Game Mode">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
      DEFEND EARTH
    </button>

  </div>

  <!-- Scripts -->
  <script src="/static/main.js"></script>

  <!-- Redirect script: Navigate to game route -->
  <script>
    (function () {
      const btn = document.getElementById('defendEarthBtn');
      if (!btn) return;

      btn.addEventListener('click', () => {
        window.location.href = '/game';
      });
    })();
  </script>
  
  <!-- NASA NEOs Modal -->
<div id="neoModal" class="modal">
  <div id="neoPanel" class="modal-panel">
    <div class="neo-header">
      <h2>NASA Near-Earth Objects</h2>
      <button id="closeNeoModal" class="close-btn">&times;</button>
    </div>
    <div id="neoContent" class="neo-content">
      <p>Loading data...</p>
    </div>
  </div>
</div>

</body>
</html>
